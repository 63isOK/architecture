# 微内核架构

微内核架构模式,也叫插件架构模式,天生用于实现基于产品的程序.

什么是基于产品的程序:一种打包的程序,
通过这个程序可以下载第三方程序的版本.
非常适合以插件方式集成其他公司提供的产品或软件.

微内核架构允许第三方程序以插件的方式集成到核心程序中,
以此提供隔离的功能.

## 微内核描述

微内核有两类组件:core system核心系统和plug-in modules插件模块.
应用程序的逻辑分布于独立的插件和基础的核心系统.
特点是:扩展性,灵活性,程序功能的隔离,处理逻辑的定制.

传统的微内核架构的核心系统仅包含使系统正常运行所需的最少功能.
很多操作系统就是使用微内核架构.从业务程序的角度看,
核心系统需要定义一般的业务逻辑,不需要考虑特殊情况/特殊规则/复杂条件.

插件模块是独立运行,独立组件,这个组件包含自己的进程,附加功能,
定制功能(对核心系统功能的增强或扩展).
另外插件之间是独立的,此处也可以设计出依赖其他插件的插进.
不管哪种形式,减少插件之间的通讯以避免依赖问题.

核心系统需要知道有哪些插件,如何获取插件.
一种常用的做法是插件注册(插件信息包括数据约定,远程访问协议).

插件和核心系统的连接可通过多种方式,OSGi(开放服务网关协议),
消息,web服务,甚至是点对点绑定.微内核架构本身是没有限制这些实现细节.

插件和核心系统的约定,可以用标准的,也可以定制.
定制约定常见于"插件是第三方开发的,而我们并没法控制约定",
这种情况下,一般需要做一个适配器,用于第三方约定和核心系统的转换,
这么做的好处是核心系统不用为特殊情况做定制.
标准约定一般是xml或java map.最好是从最开始就为约定版本指定策略.

## 例子

IDE. eclipse和vs code都是这样,通过插件提供功能.

浏览器. 浏览器都是采用微内核的架构.

## 注意事项

微内核最强的地方在于内嵌到其他架构模式,或作为其他架构模式的一部分.

有时的问题,可用微内核架构解决其中"易发挥"的部分,
再将微内核嵌入到其他架构模式.

用微内核处理事件处理组件也是不错的选择.

微内核为设计演化和增量开发提供了强有力的支持.

## 模式分析

具体的可以查看附录

__灵活性__

高,松耦合证明隔离强,容易变更.核心系统要尽可能稳定,健壮性强.

__部署难度__

低,和实现方式相关,插件可以在核心系统运行时动态添加(热部署).

__可测试性__

高,插件是隔离的,可单独测试,mock适用于插件和核心系统.

__性能__

高,微内核本身不会提供高性能,但是我们可以对程序进行自定义,
进行简化,只包含所需功能.这也是高性能的一种手段.

__可伸缩性__

低,微内核是基于产品的程序,产品就是一个单元,不具可伸缩性.

__开发难度__

高,微内核的设计和约定,导致实现很复杂.
约定的版本,插件的注册,也是复杂的点.